{"version":3,"sources":["webpack:///./src/components/Comment/index.vue?9d2d","webpack:///./src/page/Message/index.vue?442d","webpack:///./src/components/Loading/index.vue?9f88","webpack:///./src/assets/loading.svg","webpack:///./src/components/Comment/index.vue?bdf1","webpack:///src/components/Comment/index.vue","webpack:///./src/components/Comment/index.vue?448a","webpack:///./src/components/Comment/index.vue","webpack:///./src/page/Message/index.vue?ed2b","webpack:///./src/api/message.js","webpack:///src/page/Message/index.vue","webpack:///./src/page/Message/index.vue?ab89","webpack:///./src/page/Message/index.vue","webpack:///./src/components/Loading/index.vue?1bce","webpack:///src/components/Loading/index.vue","webpack:///./src/components/Loading/index.vue?58d8","webpack:///./src/components/Loading/index.vue","webpack:///./src/mixins/toTop.js"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","on","$event","preventDefault","handleSubmit","formData","directives","name","rawName","value","expression","domProps","target","composing","$set","_v","_s","nickname","length","error","content","class","disable","isDisable","title","commentCount","_l","item","key","id","avatar","formatDate","createDate","_e","staticRenderFns","components","Avatar","Loading","props","type","String","default","Number","list","Array","isLoading","Boolean","data","methods","component","ref","handleScroll","total","rows","loadingMore","hasMore","getMessages","page","limit","request","get","params","postMessage","msgInfo","post","mixins","Comment","computed","loadMoreComment","loadingSrc","refValue","mounted","$bus","$on","handleToTop","$refs","addEventListener","handleMainScroll","scrollTop","$emit","beforeDestroy","$off","removeEventListener"],"mappings":"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","file":"js/chunk-66557b8e.95bc102b.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=34c94021&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=0e2167c7&lang=less&scoped=true&\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=a4515d3e&lang=less&scoped=true&\"","module.exports = __webpack_public_path__ + \"img/loading.7d26db10.svg\";","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"comment-container\",attrs:{\"id\":\"comment-container\"}},[_c('form',{staticClass:\"fromData\",on:{\"submit\":function($event){$event.preventDefault();return _vm.handleSubmit(_vm.formData)}}},[_c('div',{staticClass:\"nickname\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.formData.nickname),expression:\"formData.nickname\"}],attrs:{\"type\":\"text\",\"maxlength\":\"10\",\"placeholder\":\"用户昵称\"},domProps:{\"value\":(_vm.formData.nickname)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.formData, \"nickname\", $event.target.value)}}}),_c('span',[_vm._v(_vm._s(_vm.formData.nickname.length)+\"/10\")])]),_c('div',{staticClass:\"error\"},[_vm._v(_vm._s(_vm.error.nickname))]),_c('div',{staticClass:\"content\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.formData.content),expression:\"formData.content\"}],attrs:{\"maxlength\":\"300\",\"rows\":\"4\",\"cols\":\"80\",\"placeholder\":\"输入内容\"},domProps:{\"value\":(_vm.formData.content)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.$set(_vm.formData, \"content\", $event.target.value)}}}),_c('span',[_vm._v(_vm._s(_vm.formData.content.length)+\"/300\")])]),_c('div',{staticClass:\"error\"},[_vm._v(_vm._s(_vm.error.content))]),_c('button',{class:{ disable: !_vm.isDisable },attrs:{\"type\":\"submit\",\"disabled\":!_vm.isDisable}},[_vm._v(\" \"+_vm._s(_vm.isDisable ? \"提 交\" : \"提 交 中 ...\")+\" \")])]),_c('div',{staticClass:\"comment\"},[_c('h3',{staticClass:\"title\"},[_vm._v(_vm._s(_vm.title))]),_c('span',{staticClass:\"number\"},[_vm._v(\"(\"+_vm._s(_vm.commentCount)+\")\")]),_c('ul',_vm._l((_vm.list),function(item){return _c('li',{key:item.id},[_c('Avatar',{attrs:{\"width\":50,\"height\":50,\"url\":item.avatar}}),_c('div',{staticClass:\"data\"},[_c('div',{staticClass:\"nickname\"},[_vm._v(_vm._s(item.nickname))]),_c('div',{staticClass:\"createTime\"},[_vm._v(\" \"+_vm._s(_vm.formatDate(item.createDate, true))+\" \")]),_c('div',{staticClass:\"content\"},[_vm._v(_vm._s(item.content))])])],1)}),0),_c('div',{staticClass:\"loading-div\"},[(_vm.isLoading)?_c('Loading'):_vm._e()],1)])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div id=\"comment-container\" class=\"comment-container\">\r\n    <form class=\"fromData\" @submit.prevent=\"handleSubmit(formData)\">\r\n      <!-- 用户名输入 -->\r\n      <div class=\"nickname\">\r\n        <input\r\n          type=\"text\"\r\n          maxlength=\"10\"\r\n          placeholder=\"用户昵称\"\r\n          v-model=\"formData.nickname\"\r\n        />\r\n        <span>{{ formData.nickname.length }}/10</span>\r\n      </div>\r\n      <div class=\"error\">{{ error.nickname }}</div>\r\n      <!-- 评论内容 -->\r\n      <div class=\"content\">\r\n        <textarea\r\n          maxlength=\"300\"\r\n          rows=\"4\"\r\n          cols=\"80\"\r\n          placeholder=\"输入内容\"\r\n          v-model=\"formData.content\"\r\n        ></textarea>\r\n        <span>{{ formData.content.length }}/300</span>\r\n      </div>\r\n      <div class=\"error\">{{ error.content }}</div>\r\n      <button\r\n        type=\"submit\"\r\n        :class=\"{ disable: !isDisable }\"\r\n        :disabled=\"!isDisable\"\r\n      >\r\n        {{ isDisable ? \"提 交\" : \"提 交 中 ...\" }}\r\n      </button>\r\n    </form>\r\n    <!-- 评论 -->\r\n    <div class=\"comment\">\r\n      <h3 class=\"title\">{{ title }}</h3>\r\n      <span class=\"number\">({{ commentCount }})</span>\r\n      <ul>\r\n        <li v-for=\"item in list\" :key=\"item.id\">\r\n          <Avatar :width=\"50\" :height=\"50\" :url=\"item.avatar\" />\r\n          <div class=\"data\">\r\n            <div class=\"nickname\">{{ item.nickname }}</div>\r\n            <div class=\"createTime\">\r\n              {{ formatDate(item.createDate, true) }}\r\n            </div>\r\n            <div class=\"content\">{{ item.content }}</div>\r\n          </div>\r\n        </li>\r\n      </ul>\r\n      <div class=\"loading-div\"><Loading v-if=\"isLoading\" /></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Avatar from \"@/components/Avatar\";\r\nimport { formatDate } from \"@/utils\";\r\nimport Loading from \"@/components/Loading\";\r\nexport default {\r\n  components: {\r\n    Avatar,\r\n    Loading,\r\n  },\r\n  props: {\r\n    title: {\r\n      type: String,\r\n      default: \"\",\r\n    },\r\n    commentCount: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    list: {\r\n      type: Array,\r\n      default: () => [],\r\n    },\r\n    isLoading: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      formData: {\r\n        nickname: \"\",\r\n        content: \"\",\r\n      },\r\n      error: {\r\n        nickname: \"\",\r\n        content: \"\",\r\n      },\r\n      isDisable: true,\r\n    };\r\n  },\r\n  methods: {\r\n    formatDate,\r\n    async handleSubmit() {\r\n      this.error.nickname = this.formData.nickname === \"\" ? \"请输入昵称!\" : \"\";\r\n      this.error.content = this.formData.content === \"\" ? \"请输入内容!\" : \"\";\r\n      // 如果有数据才抛出事件\r\n      if (this.formData.nickname && this.formData.content) {\r\n        this.isDisable = false;\r\n        // 向父组件抛出提交事件，传递评论内容，callback函数再父组件调用，再此处执行\r\n        this.$emit(\"submit\", this.formData, () => {\r\n          this.isDisable = true;\r\n          this.formData.content = \"\";\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n@import \"~@/styles/var.less\";\r\n.comment-container {\r\n  padding: 1em;\r\n  .fromData {\r\n    .nickname {\r\n      position: relative;\r\n      width: 50%;\r\n      height: 2rem;\r\n      line-height: 2em;\r\n      input {\r\n        box-sizing: border-box;\r\n        width: 100%;\r\n        height: 100%;\r\n        border: 1px dotted @gray;\r\n        text-indent: 0.5em;\r\n        outline: none;\r\n        font-size: 1rem;\r\n        &:focus {\r\n          border: 1px dotted darken(@gray, 100%);\r\n        }\r\n      }\r\n      span {\r\n        position: absolute;\r\n        right: 0.5em;\r\n        color: @gray;\r\n      }\r\n    }\r\n    .content {\r\n      position: relative;\r\n      width: 100%;\r\n      textarea {\r\n        width: 100%;\r\n        box-sizing: border-box;\r\n        resize: none;\r\n        border: 1px dotted @gray;\r\n        outline: none;\r\n        padding: 0.8em;\r\n        font-size: 1rem;\r\n        &:focus {\r\n          border: 1px dotted darken(@gray, 100%);\r\n        }\r\n      }\r\n      span {\r\n        position: absolute;\r\n        right: 0.5rem;\r\n        bottom: 0.5rem;\r\n        color: @gray;\r\n      }\r\n    }\r\n    .error {\r\n      width: 50%;\r\n      height: 1.2rem;\r\n      line-height: 1.2rem;\r\n      color: @warn;\r\n      margin: 0.5rem;\r\n      font-size: 1rem;\r\n    }\r\n    button {\r\n      padding: 0.5rem 2rem;\r\n      border: none;\r\n      color: #fff;\r\n      background: @primary;\r\n      border-radius: 3px;\r\n      cursor: pointer;\r\n      font-size: 1rem;\r\n      &:active {\r\n        transform: scale(0.95);\r\n        background: lighten(@primary, 10%);\r\n      }\r\n    }\r\n    .disable {\r\n      background: lighten(@primary, 10%);\r\n      cursor: not-allowed;\r\n    }\r\n  }\r\n  .comment {\r\n    position: relative;\r\n    ul {\r\n      list-style: none;\r\n      padding: 0;\r\n    }\r\n    .title {\r\n      display: inline-block;\r\n      margin-right: 0.5em;\r\n    }\r\n    // 头像\r\n    .avatar-container {\r\n      display: inline-block;\r\n      margin-right: 1em;\r\n    }\r\n    li {\r\n      position: relative;\r\n      display: flex;\r\n      padding: 1.5em 0;\r\n      border-bottom: 1px solid lighten(@gray, 20%);\r\n      .data {\r\n        font-size: 0.9rem;\r\n        letter-spacing: 0.1em;\r\n        .nickname {\r\n          color: @success;\r\n          display: inline-block;\r\n          font-size: 1.1rem;\r\n          margin-bottom: 0.3em;\r\n        }\r\n        .createTime {\r\n          position: absolute;\r\n          right: 1em;\r\n          font-size: 1em;\r\n          color: @gray;\r\n          display: inline-block;\r\n          letter-spacing: 0;\r\n        }\r\n      }\r\n    }\r\n    .loading-div {\r\n      position: relative;\r\n      width: 100%;\r\n      height: 100px;\r\n      text-align: center;\r\n      line-height: 40px;\r\n    }\r\n  }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=34c94021&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=34c94021&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"34c94021\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{ref:\"messageContainer\",staticClass:\"message\",on:{\"scroll\":_vm.handleScroll}},[(!_vm.data)?_c('Loading'):_vm._e(),(_vm.data)?_c('Comment',{attrs:{\"title\":\"留言板\",\"commentCount\":_vm.data.total,\"list\":_vm.data.rows,\"isLoading\":_vm.loadingMore},on:{\"submit\":_vm.handleSubmit}}):_vm._e(),(_vm.data)?_c('div',{staticClass:\"no-more-comment\"},[_vm._v(_vm._s(_vm.hasMore ? \"加载更多评论中...\":\"已没有更多评论\"))]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import request from \"./request\";\r\n\r\nexport async function getMessages(page = 1, limit = 10) {\r\n  return await request.get(\"/api/message\", {\r\n    params: {\r\n      page,\r\n      limit,\r\n    },\r\n  });\r\n}\r\n\r\nexport async function postMessage(msgInfo) {\r\n  return await request.post(\"/api/message\", msgInfo);\r\n}\r\n","<template>\r\n  <div class=\"message\" ref=\"messageContainer\" @scroll=\"handleScroll\" >\r\n    <Loading v-if=\"!data\" />\r\n    <Comment \r\n      v-if=\"data\"\r\n      title=\"留言板\"\r\n      :commentCount=\"data.total\"\r\n      :list=\"data.rows\"\r\n      @submit=\"handleSubmit\"\r\n      :isLoading=\"loadingMore\"\r\n    />\r\n    <div class=\"no-more-comment\" v-if=\"data\" >{{hasMore ? \"加载更多评论中...\":\"已没有更多评论\"}}</div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport Comment from \"@/components/Comment\";\r\nimport Loading from \"@/components/Loading\";\r\nimport {alertMessage} from \"@/utils\";\r\nimport { postMessage, getMessages } from \"@/api/message\";\r\nimport toTop from \"@/mixins/toTop\";\r\nexport default {\r\n  mixins:[toTop(\"messageContainer\")],\r\n  components: {\r\n    Loading,\r\n    Comment,\r\n  },\r\n  data() {\r\n    return{\r\n      data:null,//分页获取的留言数据 \r\n      loadingMore:false,\r\n      page:1,\r\n    }\r\n  },\r\n  computed:{\r\n    // 是否还有更多评论:等获取到评论数据后再去判断\r\n    hasMore(){\r\n      if(this.data){\r\n        return this.data.rows.length < this.data.total;\r\n      }\r\n    }\r\n  },\r\n  async created() {\r\n    this.data = await getMessages(this.page,this.limit);//获取留言\r\n  },\r\n  methods: {\r\n    // 提交评论：子组件传过来两个参数：\r\n    async handleSubmit(formData,callBack){\r\n      const msg = await postMessage(formData);\r\n      this.data.rows.unshift(msg);//将返回的数据添加到原有评论的前面\r\n      callBack();//通知子组件\r\n      this.data.total++;//留言总数++\r\n      alertMessage({content:\"感谢留言！\",type:\"success\",container:this.$refs.messageContainer});//弹框消息\r\n    },\r\n    handleScroll(){\r\n      const dom = this.$refs.messageContainer;\r\n      const range = dom.scrollHeight - (dom.clientHeight+dom.scrollTop);\r\n      if(range < 50 && dom && !this.loadingMore){\r\n        this.loadMoreComment();\r\n      }\r\n    },\r\n    async loadMoreComment(){\r\n      if(!this.hasMore){ return }\r\n      this.page ++;\r\n      this.loadingMore = true;\r\n      const newComments = await getMessages(this.page,10);\r\n      this.data.rows = this.data.rows.concat(newComments.rows);\r\n      this.loadingMore = false;\r\n    },\r\n  },\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n  @import \"~@/styles/var.less\";\r\n  .message{\r\n    position: relative;\r\n    width: 100%;\r\n    height:100%;\r\n    overflow-y: scroll;\r\n    scroll-behavior: smooth;\r\n    .no-more-comment{\r\n    width:100%;\r\n    height: 50px;\r\n    font: 1.5em;\r\n    color: @gray;\r\n    text-align: center;\r\n    margin-bottom: 3vw;\r\n  }\r\n  }\r\n</style>","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=0e2167c7&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=0e2167c7&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0e2167c7\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('img',{staticClass:\"loading-container\",attrs:{\"src\":_vm.loadingSrc,\"alt\":\"数据加载中...\",\"title\":\"数据加载中...\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <img class=\"loading-container\" :src=\"loadingSrc\" alt=\"数据加载中...\" title=\"数据加载中...\" >\r\n</template>\r\n<script>\r\n\r\nimport loadingSrc from \"@/assets/loading.svg\";\r\nexport default {\r\n  data(){\r\n    return {\r\n      loadingSrc,//简写成loadingSrc:loadingSrc,\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n@import \"~@/styles/mixin.less\";\r\n  .loading-container{\r\n    .self-center(absolute);\r\n  }\r\n</style>\r\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=a4515d3e&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=a4515d3e&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a4515d3e\",\n  null\n  \n)\n\nexport default component.exports","\r\nexport default function (refValue){\r\n  return{\r\n    mounted(){\r\n      // 监听Top组件所抛出的 toTopScroll 事件，Top被点击会执行回调\r\n      this.$bus.$on(\"toTopScroll\",this.handleToTop);\r\n      // 添加滚动事件，当滚动时会触发后面的回调函数\r\n      this.$refs[refValue].addEventListener(\"scroll\",this.handleMainScroll);\r\n    },\r\n    methods:{\r\n      // 置顶，scrollTop为Top组件抛出事件时所传的参数\r\n      handleToTop(scrollTop) {\r\n        if(this.$refs[refValue]){//判断是否有该组件。。防止报错\r\n          this.$refs[refValue].scrollTop = scrollTop;//置顶\r\n        }\r\n      },\r\n      handleMainScroll(){\r\n        // 触发mainScroll事件，并传入真实的dom，在Top组件中监听，用于是否显示Top组件\r\n        this.$bus.$emit(\"mainScroll\",this.$refs[refValue]);\r\n      }\r\n    },\r\n    beforeDestroy(){\r\n      this.$bus.$emit(\"mainScroll\",null);//第二个参数作为Top是否显示的一个条件\r\n      this.$bus.$off(\"toTopScroll\", this.handleToTop);\r\n      this.$refs[refValue].removeEventListener(\"scroll\", this.handleMainScroll);\r\n    },\r\n  }\r\n}"],"sourceRoot":""}